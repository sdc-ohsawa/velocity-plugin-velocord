# 🚀 Velocord v4.7.0 リリース

**VelocityプロキシサーバーとDiscordの完全統合プラグイン**

---

## 🎉 主要な新機能

### 📡 サーバー状態監視機能
- **自動監視**: バックエンドサーバーの稼働状態を定期的にチェック
- **Discord通知**: サーバーの起動・停止を美しいEmbed形式でDiscordに自動通知
- **賢い監視**: プレイヤー接続状況を考慮した効率的な監視システム
- **カスタマイズ可能**: 監視間隔、タイムアウト、通知チャンネルを設定可能

### 🎨 Embed形式メッセージ
- **視覚的な色分け**: 
  - 🟢 **緑**: プレイヤー参加・サーバーオンライン
  - 🔴 **赤**: プレイヤー退出・サーバーオフライン  
  - 🔵 **青**: サーバー間移動
- **統一されたデザイン**: 全てのアクションで美しいEmbed形式を採用
- **情報の整理**: 構造化されたメッセージで情報が一目で分かる

### 🖥️ サーバー状態コマンド
- **`/serverstatus`**: 管理者による手動サーバー状態確認
- **リアルタイム情報**: 現在の全サーバー状態を即座に表示
- **詳細情報**: ping応答時間とプレイヤー数も表示

---

## 🔧 重要な修正

### ✅ **Discordロール同期問題** - 完全解決
**問題**: サーバー接続後にDiscordでロールを外されても、そのままアクセスできてしまう
**解決**: 
- サーバー間移動時にも毎回リアルタイムで権限チェック
- キャッシュを使用せず、常にDiscordから最新ロール情報を取得
- 権限変更が即座に反映される安全なシステム

### ✅ **アクセス権限拒否時のスタック問題** - 完全解決  
**問題**: 権限不足時に「ワールドに接続中」画面で止まってしまう
**解決**:
- 権限拒否時に明示的にプレイヤーを切断
- わかりやすいエラーメッセージを表示（視覚的な区切り線付き）
- Discord未連携と権限不足を区別したメッセージ

---

## 🆕 その他の新機能・改善

### 🔍 強化されたデバッグ機能
- リアルタイム権限情報の詳細表示
- サーバーごとのアクセス権限テスト
- Discord連携状態とロール情報の確認

### ⚙️ 設定の柔軟性向上
- 専用チャンネルでの状態通知設定
- メッセージテンプレートのカスタマイズ
- 監視機能の有効/無効切り替え

### 🛡️ 安定性の向上
- エラー時の安全な処理を追加
- 詳細なログ出力で問題の特定が容易
- 接続処理の堅牢性を向上

---

## 📋 アップグレード手順

1. **バックアップ**: 現在の設定ファイルをバックアップ
2. **ファイル更新**: 新しい jar ファイルに置き換え
3. **設定確認**: `config.yml` に新しい設定項目が自動追加されます
4. **サーバー再起動**: Velocityプロキシを再起動

### 新しい設定項目
```yaml
# サーバー状態監視設定
server-status:
  enabled: true
  scan-delay: 30
  ping-timeout: 3000
  discord-channel: ""

# メッセージカスタマイズ設定
messages:
  use_embed_format: true
  server_online: "🟢 **%server%** server is online"
  server_offline: "🔴 **%server%** server is offline"
```

---

## 💡 使用上の注意

- **Java 17以上**が必要です
- **Discord Bot権限**で「Read Server Members」が必要です
- **online-mode=true**での使用を推奨します

---

## 🎯 今回の重点改善

このバージョンでは、ユーザーから報告された**2つの重要な問題を完全に解決**しました：

1. **セキュリティ強化**: リアルタイム権限チェックにより、Discord上でのロール変更が即座に反映
2. **ユーザビリティ向上**: 権限拒否時のスタック問題を解決し、明確なエラーメッセージを表示

さらに、**サーバー状態監視機能**と**美しいEmbed形式メッセージ**により、サーバー管理がより効率的で視覚的に分かりやすくなりました。

---

## 📊 パフォーマンス

- 軽量設計でサーバーパフォーマンスに影響なし
- HikariCP接続プールによる高速データベースアクセス
- 効率的な非同期処理でメインスレッドをブロックしない

---

**🔄 更新は簡単**: jarファイルを置き換えて再起動するだけ！  
**🛡️ 安心して使用**: 重要な問題はすべて修正済み  
**📈 継続的改善**: コミュニティフィードバックに基づく継続的な改善

---

**ダウンロード**: [Releases](https://github.com/sdc-ohsawa/velocity-plugin-velocord/releases/tag/v4.7.0)  
**サポート**: [Issues](https://github.com/sdc-ohsawa/velocity-plugin-velocord/issues)  
**ドキュメント**: [README.md](https://github.com/sdc-ohsawa/velocity-plugin-velocord/blob/main/README.md) 